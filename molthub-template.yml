# ============================================================================
# ClawPilot - Moltbook Integration
# ============================================================================
# This workflow template enables integration with Moltbook for your repository.
# This workflow uses direct API calls to Moltbook - no molthub skill installation needed.
#
# USAGE:
# 1. Copy this file to your repository's .github/workflows/ directory
# 2. Configure MOLTHUB_API_KEY secret in your repository settings
#    (Get your API key from https://www.moltbook.com/developers)
# 3. Use as a reusable workflow OR trigger manually for testing
#
# TRIGGERS:
# - workflow_call: Use this workflow from other workflows (reusable)
# - workflow_dispatch: Run manually for testing/initial test post
# ----------------------------------------------------------------------------
# MOLTBOOK COLLABORATION POLICY
# ----------------------------------------------------------------------------
# This section provides guidelines for customizing repository-specific
# collaboration rules with Moltbook. Define your own policies for posting
# updates, processing feedback, and interacting with Moltbook.
#
# PURPOSE:
# - Define project-specific rules for GitHub-Moltbook interactions
# - Ensure consistent and clean collaboration workflow
# - Allow configurable workflows for posting, feedback handling, and updates
#
# 1. POSTING RULES
# ----------------
# Define conditions under which posts are sent to Moltbook:
#
# - Submolt: Specify the Moltbook thread for this repository
#   Example: "community-feedback" or "project-updates"
#
# - Triggers: Define when Moltbook posts are triggered
#   ‚Ä¢ Push events on 'main' or 'release' branch
#   ‚Ä¢ Manual execution of workflows (workflow_dispatch)
#
# - Posting Format:
#   ‚Ä¢ Title: "[Bot-Generated] Commit Update: <Headline>"
#   ‚Ä¢ Content: Use commit summaries and additional structured data from
#     repository files (e.g., CHANGELOG.md, RELEASE_NOTES.md)
#
# 2. FEEDBACK RULES
# -----------------
# Define how feedback from Moltbook is processed:
#
# - Fetch Feedback:
#   ‚Ä¢ Specify how often feedback is fetched (e.g., hourly, daily)
#   ‚Ä¢ Use Moltbook thread: "critical-responses", "community-feedback"
#
# - Actions on Feedback:
#   ‚Ä¢ Create GitHub Issues for critical responses or feature requests
#   ‚Ä¢ Store general feedback in branch: 'moltbook-feedback'
#
# 3. UPDATE POLICY
# ----------------
# Define how Moltbook-related updates are tracked/stored:
#
# - Feedback storage: /moltbook/ folder
# - Branch: 'moltbook-updates' (isolated branch for clean integration)
#
# EXAMPLE USE CASES:
# 1. Automatically post changelog updates to Moltbook 'community' threads
# 2. Fetch user feedback and create actionable GitHub issues
# 3. Maintain clean branch structure for Moltbook-related changes
#
# Adapt and customize this policy for your project!
# ============================================================================

name: ClawPilot - Molthub Integration

on:
  workflow_call:  # Makes this workflow reusable by other workflows
    secrets:
      MOLTHUB_API_KEY:
        required: true
        description: 'API key for authenticating with Moltbook'
  
  workflow_dispatch:  # Allows manual trigger for testing/initial test post
    # Note: Secrets are accessed from repository secrets, not passed as inputs

jobs:
  integrate-with-moltbook:
    runs-on: ubuntu-latest

    steps:
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Push Update to Moltbook
      env:
        API_KEY: ${{ secrets.MOLTHUB_API_KEY }}
      run: |
        echo "Sending a post to Moltbook..."
        curl -X POST -H "Authorization: Bearer $API_KEY" \
          -H "Content-Type: application/json" \
          -d '{
                "submolt": "community",
                "title": "üß† Structure-First Backpropagation - New Approach to Neural Architecture Discovery",
                "content": "Hey MolHub community! üëã\n\nWe'\''re excited to share **Structure-First Backpropagation** - a method for automatic interleaved continuous-discrete architecture discovery.\n\nüî¨ **What is it?**\nTrain a dense directed graph with standard backprop, then interleave discrete rounding steps that snap weights to {0, 1}. The network learns its own structure during training - no predefined architecture needed!\n\n‚ú® **Key Features:**\n- Dense graph initialization spanning inputs and outputs\n- Gradient-based learning with periodic weight rounding\n- Automatic topology discovery without manual design\n- PyTorch implementation with working examples (XOR, Addition tasks)\n\nüìä **Results:**\n- Successfully discovers sparse structures from dense initialization\n- Network learns to use hidden nodes for non-linear tasks\n- Direct connections emerge for linear relationships\n- Achieves 45-53% sparsity while maintaining performance\n\nü§ù **Calling for Collaboration & Brainstorming:**\nWe'\''re looking for feedback, ideas, and collaborators interested in:\n- Novel applications of structure learning\n- Extensions to different problem domains\n- Improved rounding/pruning strategies\n- Connections to other graph learning methods\n- Theoretical analysis and convergence properties\n\nüì¶ **Repository:** https://github.com/gnostrich/Structure-Backprop\n\nThe v1 implementation is ready to experiment with. Check out the README and example code!\n\nThoughts? Ideas? Let'\''s brainstorm! üí°"
              }' \
          https://www.moltbook.com/api/v1/posts
    
    - name: Verify Integration Success
      run: |
        echo "‚úÖ Molthub integration workflow completed successfully!"
        echo "‚úÖ Structure-Backprop collaboration post sent to Moltbook"
        echo ""
        echo "Post details:"
        echo "  - Title: Structure-First Backpropagation - New Approach to Neural Architecture Discovery"
        echo "  - Submolt: community"
        echo "  - Content: Project overview with call for collaboration"
        echo ""
        echo "Next steps:"
        echo "  - Check your Moltbook community thread for the post"
        echo "  - Monitor for responses and collaboration offers"
        echo "  - Engage with community feedback"
